immunization:
  requirements:
    states:
      MA:

        # =========================================================
        # SCHOOL YEAR–BASED REQUIREMENTS
        # =========================================================
        # The validator resolves rules by:
        #   state + schoolYear
        # =========================================================

        schoolYear:

          # =======================================================
          # PRESCHOOL / CHILDCARE (≥ 2 YEARS, K0 / K1)
          # =======================================================
          # Bible:
          # - Hib has multiple valid catch-up paths
          # - All other vaccines use minimum dose counts
          # =======================================================

          # -----------------------------
          # HIB – Haemophilus influenzae type b
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "Hib"

            # Default rule: full series
            minDoses: 4
            description: "Hib - 4-dose series required unless valid catch-up schedule applies"

            # Catch-up schedules supported by code
            alternateRequirements:

              # Catch-up if series completed late
              - minDoses: 3
                description: "3-dose Hib catch-up series with last dose on or after 1st birthday"
                dateConditions:
                  - "3rd dose on or after 1st birthday"

              # Late start rule
              - minDoses: 1
                description: "Single Hib dose acceptable if first dose given on/after 15 months"
                dateConditions:
                  - "1st dose on or after 15th month"
                notes: "Late-start Hib schedule per MA DPH"

            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          # -----------------------------
          # DTaP
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "DTaP"
            minDoses: 4
            description: "DTaP - 4 doses required for preschool"

            dateConditions:
              - "4th dose on or after 4th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          # -----------------------------
          # POLIO
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "Polio"
            minDoses: 3
            description: "Polio - 3 doses required for preschool"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          # -----------------------------
          # HEPATITIS B
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "HepB"
            minDoses: 3
            description: "Hepatitis B - 3 doses required"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"
            notes: "Laboratory evidence of immunity acceptable"

          # -----------------------------
          # MMR
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "MMR"
            minDoses: 1
            description: "MMR - 1 dose required for preschool"
            dateConditions:
              - "1st dose on or after 1st birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"

          # -----------------------------
          # VARICELLA
          # -----------------------------
          - schoolYear: "preschool"
            vaccineCode: "Varicella"
            minDoses: 1
            description: "Varicella - 1 dose required for preschool"
            dateConditions:
              - "1st dose on or after 1st birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"
              - "RELIABLE_HISTORY_CHICKENPOX"

          # =======================================================
          # GRADES K–6
          # =======================================================
          # Bible:
          # - Full childhood series required
          # - Birthday-based alternates allowed
          # =======================================================

          - schoolYear: "K-6"
            vaccineCode: "DTaP"
            minDoses: 5
            description: "DTaP - 5 doses required unless 4th dose given on/after 4th birthday"
            alternateRequirements:
              - minDoses: 4
                description: "4 doses acceptable if 4th dose on or after 4th birthday"
                dateConditions:
                  - "4th dose on or after 4th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          - schoolYear: "K-6"
            vaccineCode: "Polio"
            minDoses: 4
            description: "Polio - 4 doses required"
            alternateRequirements:
              - minDoses: 3
                description: "3 doses acceptable if 3rd dose on or after 4th birthday"
                dateConditions:
                  - "3rd dose on or after 4th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          - schoolYear: "K-6"
            vaccineCode: "MMR"
            minDoses: 2
            description: "MMR - 2 doses required"
            intervalConditions:
              - "at least 28 days between doses"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"

          - schoolYear: "K-6"
            vaccineCode: "Varicella"
            minDoses: 2
            description: "Varicella - 2 doses required"
            intervalConditions:
              - "at least 28 days between doses"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"
              - "RELIABLE_HISTORY_CHICKENPOX"

          # =======================================================
          # GRADES 7–10
          # =======================================================
          # Bible:
          # - Tdap required once after age 10
          # - MenACWY required once after age 10
          # =======================================================

          - schoolYear: "7-10"
            vaccineCode: "Tdap"
            minDoses: 1
            description: "Tdap - 1 dose required on or after 10th birthday"
            dateConditions:
              - "1st dose on or after 10th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          - schoolYear: "7-10"
            vaccineCode: "MenACWY"
            minDoses: 1
            description: "MenACWY - 1 dose required on or after 10th birthday"
            dateConditions:
              - "1st dose on or after 10th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          # =======================================================
          # GRADES 11–12
          # =======================================================
          # Bible:
          # - MenACWY booster logic
          # =======================================================

          - schoolYear: "11-12"
            vaccineCode: "MenACWY"
            minDoses: 2
            description: "MenACWY - 2 doses required unless first dose on/after 16th birthday"
            alternateRequirements:
              - minDoses: 1
                description: "1 dose acceptable if first dose on or after 16th birthday"
                dateConditions:
                  - "1st dose on or after 16th birthday"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"

          # =======================================================
          # COLLEGE / POST-SECONDARY
          # =======================================================
          # Bible:
          # - Birth year exemptions allowed
          # - Signed waivers allowed
          # - Heplisav-B supported for ≥18
          # =======================================================

          - schoolYear: "college"
            vaccineCode: "MMR"
            minDoses: 2
            description: "MMR - 2 doses required for college students"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"
              - "BIRTH_BEFORE_1957"

          - schoolYear: "college"
            vaccineCode: "Varicella"
            minDoses: 2
            description: "Varicella - 2 doses required for college students"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "LABORATORY_EVIDENCE"
              - "RELIABLE_HISTORY_CHICKENPOX"
              - "BIRTH_BEFORE_1980"

          - schoolYear: "college"
            vaccineCode: "MenACWY"
            minDoses: 1
            description: "MenACWY - 1 dose required for college students ≤21"
            acceptedExceptions:
              - "MEDICAL_CONTRAINDICATION"
              - "RELIGIOUS_EXEMPTION"
              - "SIGNED_WAIVER"
